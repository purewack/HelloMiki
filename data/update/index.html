<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Update Panel</h1>

    <form method="post" enctype="multipart/form-data" action="/device/reset">
        <input type="submit" name="ota"  value="Reset Device"/>
    </form>

    <form id="ota" method="post" enctype="multipart/form-data" >
        <label for="ota">Hardware Firmware</label>
        <input id="otafile" type="file" name="ota"  value="Upload" accept=".bin, application/x-binary" />
        <input type="submit" name="ota"  value="Upload"/>
        <p id="updateLabel"></p>
    </form>

    <form method="post" enctype="multipart/form-data" action="/device/upload?type=public">
        <label for="public_webapp">Server files</label>
        <input type="file" name="public_webapp" webkitdirectory mozdirectory value="Upload"/>
        <input type="submit" name="public_webapp"  value="Upload"/>
    </form>

    <script defer> 
        const otaField = document.querySelector('#ota');
        const otaFile = document.querySelector('#otafile');

        otaFile.onchange = ()=>{
            otaField.action = "/device/upload?type=ota&size=" + otaFile.files[0].size;
            console.log(otaField.action)
        }

        const ws = new WebSocket("ws://"+window.location.hostname+"/ws/monitor");
        const updateLabel = document.querySelector('#updateLabel')
        ws.onopen = ev=>{
            updateLabel.innerHTML = "Await update";
        }
        ws.onmessage = ev=>{
            updateLabel.innerHTML = ev.data;
        }
    </script>
</body>
</html>